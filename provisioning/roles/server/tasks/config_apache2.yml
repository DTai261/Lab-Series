---
- name: Configure Apache and create secret page
  hosts: server
  become: true

  tasks:
    - name: Start Apache service
      service:
        name: apache2
        state: started
###################################################################
    - name: Create secret directory
      file:
        path: /var/www/html/secret
        state: directory

    - name: Create secret index.html file
      copy:
        dest: /var/www/html/secret/index.html
        src: index1.html

    - name: Configure secret Apache site
      copy:
        dest: /etc/apache2/sites-enabled/001-secret.conf
        src: 001-secret.conf
#############################################################
    - name: Create super_secret directory
      file:
        path: /var/www/html/super_secret
        state: directory

    - name: Create super_secret index.html file
      copy:
        dest: /var/www/html/super_secret/index.html
        src: index2.html

    - name: Configure secret Apache site
      copy:
        dest: /etc/apache2/sites-enabled/001-super_secret.conf
        src: 001-super_secret.conf
###################################################################
    - name: Specify username and password of user
      shell: htpasswd -c /etc/apache2/.htaccess_secret user --stdin
      args:
        stdin: Password123
      no_log: true

    - name: Specify username and password of user 2
      shell: htpasswd -c /etc/apache2/.htaccess_super_secret user2 --stdin
      args:
        stdin: '{{ flag_1 }}'
      no_log: true

    - name: Restart Apache service
      service:
        name: apache2
        state: restarted
